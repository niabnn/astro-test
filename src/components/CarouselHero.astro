---
import Carousel from "./Carousel";
import type { GalleryImage } from "./Carousel";

const res = await fetch(
  "https://wp.tusanagustin.com/wp/wp-json/wp/v2/posts?_embed&per_page=5",
  { cache: "no-store" }
);
const posts = (await res.json()) as any[];

// Paso 1: Permitir null temporalmente
const tempImages: (GalleryImage | null)[] = posts.map((post) => {
  const imageUrl = post._embedded?.["wp:featuredmedia"]?.[0]?.source_url;
  const category = post._embedded?.["wp:term"]?.[0]?.[0]?.name ?? "Sin categor√≠a";
  const description = post.excerpt.rendered.replace(/<[^>]+>/g, "").trim();
  if (!imageUrl) return null;
  return {
    src: imageUrl,
    alt: post.title.rendered,   
    width: 800,
    height: 600,
    category,
    description
  };
});

//Filtrar null y afirmar tipo
const images: GalleryImage[] = tempImages.filter(
  (img): img is GalleryImage => img !== null
);
---

<section class="container mx-auto px-4 2xl:max-w-[1400px]">
  <Carousel images={images} client:load />
</section>
